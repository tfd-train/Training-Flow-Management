<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>臺北市政府消防局 114年教育訓練管理系統 (藍色統一版)</title>
    <style>
        :root {
            --sidebar-bg: #1e293b; /* 深藍灰側邊欄 */
            --active-item: #334155;
            --accent: #3b82f6; /* 亮藍 */
            --bg-color: #f1f5f9;
            --border-color: #cbd5e1;
            --header-bg: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            color: #333;
        }

        /* --- 側邊欄 --- */
        .sidebar {
            width: 240px;
            background-color: var(--sidebar-bg);
            color: white;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        .sidebar-header {
            padding: 20px;
            background-color: #0f172a;
            border-bottom: 1px solid #334155;
        }
        .sidebar-header h2 { margin: 0; font-size: 18px; letter-spacing: 1px; }
        
        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            border-left: 4px solid transparent;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            font-size: 14px;
        }
        .nav-item:hover { background-color: var(--active-item); color: white; }
        .nav-item.active { 
            background-color: var(--active-item); 
            color: var(--accent); 
            border-left-color: var(--accent); 
            font-weight: bold; 
        }

        /* --- 主內容區 --- */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            height: 55px;
            background: white;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
        }
        .page-title { font-size: 18px; font-weight: 600; color: #1e293b; }

        .workspace {
            flex: 1;
            padding: 20px;
            overflow: hidden; /* 內部滾動 */
            display: flex;
            flex-direction: column;
        }

        /* --- 視圖區塊 --- */
        .view-section {
            display: none;
            height: 100%;
            flex-direction: column;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .view-section.active { display: flex; }

        .table-container {
            flex: 1;
            overflow: auto;
        }

        /* --- 表格樣式 --- */
        table {
            border-collapse: collapse;
            font-size: 13px;
            table-layout: fixed; /* 關鍵 */
            width: 100%;
        }

        /* 強制表格最小寬度 */
        #table1 { min-width: 2000px; }
        #table2 { min-width: 1800px; }
        #table3 { min-width: 1400px; }
        #table4 { min-width: 1600px; }

        th {
            background-color: var(--header-bg);
            color: #475569;
            font-weight: 700;
            border: 1px solid #94a3b8;
            text-align: center;
            vertical-align: middle;
            position: sticky;
            top: 0;
            z-index: 10;
            height: 50px;
            padding: 4px;
        }

        /* 表頭文字置中 */
        .th-content {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            line-height: 1.4;
            white-space: normal;
        }

        td {
            border: 1px solid #cbd5e1;
            padding: 0;
            height: 36px;
            background: white;
            position: relative;
        }

        /* --- 輸入框 --- */
        input[type="text"], input[type="number"] {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            background: transparent;
            text-align: center;
            font-family: inherit;
            font-size: 13px;
        }
        input:focus { background-color: #eff6ff; box-shadow: inset 0 0 0 2px var(--accent); }
        .align-left input { text-align: left; padding-left: 8px; }

        /* --- 日期與排除六日複合欄位 --- */
        .date-cell {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .date-cell input {
            flex: 1;
            border-bottom: 1px dotted #e2e8f0;
        }
        .date-cell label {
            font-size: 10px;
            color: #64748b;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            height: 16px;
        }
        .date-cell label:hover { background: #e2e8f0; color: #000; }
        .date-cell input[type="checkbox"] { width: auto; height: auto; margin-right: 4px; }

        /* --- 仿 Excel 勾選框 --- */
        .td-checkbox { text-align: center !important; vertical-align: middle !important; }
        .excel-checkbox {
            appearance: none; -webkit-appearance: none;
            width: 18px; height: 18px;
            border: 1px solid #333; background-color: white;
            cursor: pointer; display: inline-block;
            position: relative; vertical-align: middle; margin: 0;
        }
        .excel-checkbox:checked::after {
            content: '✓'; font-size: 14px; font-weight: 900; color: #000;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .excel-checkbox:hover { background-color: #f1f5f9; }

        /* --- 甘特圖樣式 (藍色統一版) --- */
        .gantt-header-month td {
            background-color: #e2e8f0;
            font-weight: bold;
            text-align: left;
            padding-left: 15px;
            border-top: 2px solid #475569;
            border-bottom: 1px solid #94a3b8;
            color: #1e293b;
        }

        .gantt-visual-row { height: 15px; }
        .gantt-data-row { height: 30px; }

        .gantt-cell-bar { border-right: 1px solid #e2e8f0; }
        
        /* 統一使用單一藍色色塊 */
        .bar-active { 
            background-color: #3b82f6; 
            border: 1px solid #2563eb; 
        }

        .gantt-num input { font-weight: bold; color: #0f172a; font-size: 12px; }

        .stats-row td {
            background-color: #f0f9ff; 
            border-top: 2px double #94a3b8;
            border-bottom: 2px solid #333;
            color: #0369a1;
            font-weight: bold;
            font-size: 12px;
            text-align: center;
        }
        
        .gantt-name-cell {
            background-color: #fff;
            border-bottom: 2px solid #cbd5e1;
            padding-left: 10px;
            font-size: 12px;
            vertical-align: middle;
        }

        /* --- 按鈕與色彩 --- */
        .btn-action {
            padding: 6px 16px; border-radius: 4px; border: none; color: white; 
            font-size: 13px; cursor: pointer; margin-left: 8px;
        }
        .btn-add-row {
            width: 100%; padding: 10px; background: #fff; border: 1px dashed #94a3b8;
            color: var(--accent); font-weight: bold; cursor: pointer;
            border-top: none;
        }
        .btn-add-row:hover { background: #eff6ff; }

        .col-yellow { background-color: #ffffcc; }
        .col-blue-light { background-color: #e0f2fe; }
        .col-red-light { background-color: #fee2e2; }
        
        .text-manpower { color: #1d4ed8; font-weight: bold; }
        .text-danger { color: #ef4444; font-weight: bold; }

    </style>
</head>
<body>

    <!-- 側邊欄 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>教育訓練管理系統</h2>
            <span style="font-size:11px; color:#64748b">114年度版</span>
        </div>
        <nav>
            <div class="nav-item active" onclick="switchTab(1, this)">1. 消防人員訓練</div>
            <div class="nav-item" onclick="switchTab(2, this)">2. 非消防人員訓練</div>
            <div class="nav-item" onclick="switchTab(3, this)">3. 重大活動</div>
            <div class="nav-item" onclick="switchTab(4, this)">4. 甘特圖流路</div>
        </nav>
    </div>

    <!-- 主內容 -->
    <div class="main-content">
        <div class="top-bar">
            <div class="page-title" id="pageTitle">附件1 - 消防人員訓練</div>
            <div>
                <button class="btn-action" style="background:#16a34a" onclick="alert('模擬：Excel 報表生成中...')">下載 Excel</button>
                <button class="btn-action" style="background:#dc2626" onclick="alert('模擬：PDF 報表生成中...')">下載 PDF</button>
            </div>
        </div>

        <div class="workspace">
            
            <!-- TAB 1: 消防人員 -->
            <div id="view1" class="view-section active">
                <div class="table-container">
                    <table id="table1">
                        <thead>
                            <tr>
                                <th style="width:40px">刪</th>
                                <th style="width:40px">項次</th>
                                <th style="width:40px">月份</th>
                                <th style="width:100px">承辦單位</th>
                                <th style="width:200px">課程名稱</th>
                                <th style="width:80px">訓練對象</th>
                                <th style="width:140px">課程日期</th>
                                <th style="width:120px">上課地點</th>
                                <th style="width:40px">梯數</th>
                                <th style="width:50px">每梯<br>人數</th>
                                <th style="width:50px">合計<br>人數</th>
                                <th style="width:50px">每天<br>時數</th>
                                <th style="width:50px">每梯<br>時數</th>
                                <th style="width:50px">合計<br>時數</th>
                                <th style="width:100px" class="col-blue-light"><div class="th-content">預計調用人數<br>(分隊人力)</div></th>
                                <th style="width:120px" class="col-yellow"><div class="th-content">是否提供宜基<br>北桃參訓</div></th>
                                <th style="width:60px" class="col-yellow"><div class="th-content">暫訂<br>新北</div></th>
                                <th style="width:60px" class="col-yellow"><div class="th-content">暫訂<br>基隆</div></th>
                                <th style="width:60px" class="col-yellow"><div class="th-content">暫訂<br>桃園</div></th>
                                <th style="width:60px" class="col-yellow"><div class="th-content">暫訂<br>宜蘭</div></th>
                                <th style="width:150px">備註</th>
                            </tr>
                        </thead>
                        <tbody id="tbody1"></tbody>
                    </table>
                </div>
                <button class="btn-add-row" onclick="addRow(1)">+ 新增 消防人員課程</button>
            </div>

            <!-- TAB 2: 非消防人員 -->
            <div id="view2" class="view-section">
                <div class="table-container">
                    <table id="table2">
                        <thead>
                            <tr>
                                <th style="width:40px">刪</th>
                                <th style="width:40px">序號</th>
                                <th style="width:40px">月份</th>
                                <th style="width:100px">承辦單位</th>
                                <th style="width:200px">課程名稱</th>
                                <th style="width:120px">訓練對象</th>
                                <th style="width:140px">課程日期</th>
                                <th style="width:120px">訓練地點</th>
                                <th style="width:40px">梯數</th>
                                <th style="width:50px">每梯<br>人數</th>
                                <th style="width:50px">合計<br>人數</th>
                                <th style="width:50px">每天<br>時數</th>
                                <th style="width:50px">每梯<br>時數</th>
                                <th style="width:50px">合計<br>時數</th>
                                <th style="width:80px">調用本局<br>教官人數</th>
                                <th style="width:100px"><div class="th-content">是否提供<br>跨縣市</div></th>
                                <th style="width:150px">備註</th>
                            </tr>
                        </thead>
                        <tbody id="tbody2"></tbody>
                    </table>
                </div>
                <button class="btn-add-row" onclick="addRow(2)">+ 新增 非消防人員課程</button>
            </div>

            <!-- TAB 3: 重大活動 -->
            <div id="view3" class="view-section">
                <div class="table-container">
                    <table id="table3">
                        <thead>
                            <tr>
                                <th style="width:40px">刪</th>
                                <th style="width:40px">序號</th>
                                <th style="width:100px">承辦單位</th>
                                <th style="width:250px">重大活動演習名稱</th>
                                <th style="width:150px">參加對象</th>
                                <th style="width:140px">日期</th>
                                <th style="width:50px">天數</th>
                                <th style="width:50px">時數</th>
                                <th style="width:100px" class="col-red-light"><div class="th-content">每日調用<br>外勤人數</div></th>
                                <th style="width:150px">地點(教室)</th>
                            </tr>
                        </thead>
                        <tbody id="tbody3"></tbody>
                    </table>
                </div>
                <button class="btn-add-row" onclick="addRow(3)">+ 新增 重大活動</button>
            </div>

            <!-- TAB 4: 甘特圖 -->
            <div id="view4" class="view-section">
                <div style="padding:12px 16px; background:#fffbeb; border-bottom:1px solid #fbbf24; font-size:13px; color:#92400e;">
                    ⚠️ <strong>統計說明：</strong> 
                    統計範圍包含「附件1調用人數」+「附件2教官人數」+「附件3外勤人數」。
                    若在日期欄位勾選「排除六日」，甘特圖將自動跳過週六日不計入統計。
                </div>
                <div class="table-container">
                    <table id="table4">
                        <thead>
                            <tr id="ganttHeader">
                                <th style="width:250px">班期 / 活動名稱</th>
                                <!-- JS 將自動生成 1-31 的標題 -->
                            </tr>
                        </thead>
                        <tbody id="tbody4">
                            <!-- JS 生成甘特圖內容 -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- 初始模擬資料 ---
        // 欄位: exclude 代表是否排除六日
        let d1 = [
            {m:'1', unit:'訓練中心', name:'火災搶救初級班', date:'1/6-19', mp:20, exclude:true, ext:false},
            {m:'1', unit:'訓練中心', name:'112年警特班', date:'1/10-24', mp:4, exclude:false, ext:false}
        ];
        let d2 = [
            {m:'1', unit:'應變科', name:'防災業務研習班', date:'1/13-15', inst:2, exclude:false, ext:false}
        ];
        let d3 = [
            {unit:'秘書室', name:'119消防節慶祝大會', date:'1/16', mp:25, exclude:false}
        ];

        // --- Tab 切換邏輯 ---
        function switchTab(idx, btn) {
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            btn.classList.add('active');
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.getElementById(`view${idx}`).classList.add('active');
            
            const titles = ['附件1 - 消防人員訓練', '附件2 - 非消防人員訓練', '附件3 - 重大活動', '甘特圖 - 訓練流路'];
            document.getElementById('pageTitle').innerText = titles[idx-1];

            if(idx === 4) renderGantt();
        }

        // --- 渲染 Table 1 ---
        function renderT1() {
            const tb = document.getElementById('tbody1');
            tb.innerHTML = '';
            d1.forEach((r, i) => {
                tb.innerHTML += `<tr>
                    <td><button onclick="del(1,${i})" style="width:100%;color:#9ca3af;background:none;border:none;cursor:pointer;">×</button></td>
                    <td><input type="text" value="${i+1}" readonly style="color:#999"></td>
                    <td><input type="text" value="${r.m||''}" onchange="d1[${i}].m=this.value"></td>
                    <td><input type="text" value="${r.unit||''}" onchange="d1[${i}].unit=this.value"></td>
                    <td class="align-left"><input type="text" value="${r.name||''}" onchange="d1[${i}].name=this.value"></td>
                    <td><input type="text" value="${r.target||''}" onchange="d1[${i}].target=this.value"></td>
                    <td>
                        <div class="date-cell">
                            <input type="text" value="${r.date||''}" onchange="d1[${i}].date=this.value" placeholder="1/6-19">
                            <label><input type="checkbox" ${r.exclude?'checked':''} onchange="d1[${i}].exclude=this.checked">排除六日</label>
                        </div>
                    </td>
                    <td><input type="text" value="${r.loc||''}" onchange="d1[${i}].loc=this.value"></td>
                    <td><input type="number" value="${r.batch||''}" onchange="d1[${i}].batch=this.value"></td>
                    <td><input type="number" value="${r.pBatch||''}" onchange="d1[${i}].pBatch=this.value"></td>
                    <td style="background:#f8fafc;text-align:center;line-height:36px;color:#64748b;">${(r.batch*r.pBatch)||0}</td>
                    <td><input type="number" value="${r.dHour||''}" onchange="d1[${i}].dHour=this.value"></td>
                    <td><input type="number" value="${r.bHour||''}" onchange="d1[${i}].bHour=this.value"></td>
                    <td style="background:#f8fafc;text-align:center;line-height:36px;color:#64748b;">${(r.batch*r.bHour)||0}</td>
                    <td class="col-blue-light"><input type="number" value="${r.mp||''}" onchange="d1[${i}].mp=this.value" class="text-manpower"></td>
                    
                    <td class="td-checkbox"><input type="checkbox" class="excel-checkbox" ${r.ext?'checked':''} onchange="d1[${i}].ext=this.checked"></td>
                    
                    <td><input type="number" value="${r.nt||''}" onchange="d1[${i}].nt=this.value"></td>
                    <td><input type="number" value="${r.kl||''}" onchange="d1[${i}].kl=this.value"></td>
                    <td><input type="number" value="${r.ty||''}" onchange="d1[${i}].ty=this.value"></td>
                    <td><input type="number" value="${r.yl||''}" onchange="d1[${i}].yl=this.value"></td>
                    <td class="align-left"><input type="text" value="${r.note||''}" onchange="d1[${i}].note=this.value"></td>
                </tr>`;
            });
        }

        // --- 渲染 Table 2 ---
        function renderT2() {
            const tb = document.getElementById('tbody2');
            tb.innerHTML = '';
            d2.forEach((r, i) => {
                tb.innerHTML += `<tr>
                    <td><button onclick="del(2,${i})" style="width:100%;color:#9ca3af;background:none;border:none;cursor:pointer;">×</button></td>
                    <td><input type="text" value="${i+1}" readonly style="color:#999"></td>
                    <td><input type="text" value="${r.m||''}" onchange="d2[${i}].m=this.value"></td>
                    <td><input type="text" value="${r.unit||''}" onchange="d2[${i}].unit=this.value"></td>
                    <td class="align-left"><input type="text" value="${r.name||''}" onchange="d2[${i}].name=this.value"></td>
                    <td><input type="text" value="${r.target||''}" onchange="d2[${i}].target=this.value"></td>
                    <td>
                        <div class="date-cell">
                            <input type="text" value="${r.date||''}" onchange="d2[${i}].date=this.value">
                            <label><input type="checkbox" ${r.exclude?'checked':''} onchange="d2[${i}].exclude=this.checked">排除六日</label>
                        </div>
                    </td>
                    <td><input type="text" value="${r.loc||''}" onchange="d2[${i}].loc=this.value"></td>
                    <td><input type="number" value="${r.batch||''}" onchange="d2[${i}].batch=this.value"></td>
                    <td><input type="number" value="${r.pBatch||''}" onchange="d2[${i}].pBatch=this.value"></td>
                    <td style="background:#f8fafc;text-align:center;line-height:36px;color:#64748b;">${(r.batch*r.pBatch)||0}</td>
                    <td><input type="number" value="${r.dHour||''}" onchange="d2[${i}].dHour=this.value"></td>
                    <td><input type="number" value="${r.bHour||''}" onchange="d2[${i}].bHour=this.value"></td>
                    <td style="background:#f8fafc;text-align:center;line-height:36px;color:#64748b;">${(r.batch*r.bHour)||0}</td>
                    <td><input type="number" value="${r.inst||''}" onchange="d2[${i}].inst=this.value"></td>
                    <td class="td-checkbox"><input type="checkbox" class="excel-checkbox" ${r.ext?'checked':''} onchange="d2[${i}].ext=this.checked"></td>
                    <td class="align-left"><input type="text" value="${r.note||''}" onchange="d2[${i}].note=this.value"></td>
                </tr>`;
            });
        }

        // --- 渲染 Table 3 ---
        function renderT3() {
            const tb = document.getElementById('tbody3');
            tb.innerHTML = '';
            d3.forEach((r, i) => {
                tb.innerHTML += `<tr>
                    <td><button onclick="del(3,${i})" style="width:100%;color:#9ca3af;background:none;border:none;cursor:pointer;">×</button></td>
                    <td><input type="text" value="${i+1}" readonly style="color:#999"></td>
                    <td><input type="text" value="${r.unit||''}" onchange="d3[${i}].unit=this.value"></td>
                    <td class="align-left"><input type="text" value="${r.name||''}" onchange="d3[${i}].name=this.value"></td>
                    <td><input type="text" value="${r.target||''}" onchange="d3[${i}].target=this.value"></td>
                    <td>
                        <div class="date-cell">
                            <input type="text" value="${r.date||''}" onchange="d3[${i}].date=this.value" placeholder="1/16">
                            <label><input type="checkbox" ${r.exclude?'checked':''} onchange="d3[${i}].exclude=this.checked">排除六日</label>
                        </div>
                    </td>
                    <td><input type="number" value="${r.days||''}" onchange="d3[${i}].days=this.value"></td>
                    <td><input type="number" value="${r.hours||''}" onchange="d3[${i}].hours=this.value"></td>
                    <td class="col-red-light"><input type="number" value="${r.mp||''}" onchange="d3[${i}].mp=this.value" class="text-danger"></td>
                    <td class="align-left"><input type="text" value="${r.loc||''}" onchange="d3[${i}].loc=this.value"></td>
                </tr>`;
            });
        }

        // --- 甘特圖 (藍色統一色塊) ---
        function renderGantt() {
            const header = document.getElementById('ganttHeader');
            header.innerHTML = '<th style="width:250px">班期 / 活動名稱</th>';
            for(let i=1; i<=31; i++) header.innerHTML += `<th style="width:30px; font-size:11px; color:#64748b;">${i}</th>`;

            const tbody = document.getElementById('tbody4');
            tbody.innerHTML = '';

            // 1. 解析函數
            const parse = (str, month, exclude) => {
                let days = [];
                if(!str) return days;
                try {
                    let s = str.replace(/\(.*\)/g, '').trim();
                    let rng = s.match(/(\d+)\/(\d+)-(\d+)/);
                    let sgl = s.match(/(\d+)\/(\d+)/);
                    let candidates = [];
                    if(rng) { for(let i=+rng[2]; i<=+rng[3]; i++) candidates.push(i); } 
                    else if(sgl) { candidates.push(+sgl[2]); } 
                    else if(s.includes(',')) { s.split(',').forEach(p => { let m = p.match(/\d+$/); if(m) candidates.push(+m[0]); }); }

                    candidates.forEach(day => {
                        if(exclude) {
                            let dt = new Date(2025, month-1, day);
                            let wd = dt.getDay();
                            if(wd !== 0 && wd !== 6) days.push(day);
                        } else { days.push(day); }
                    });
                } catch(e){}
                return days;
            };

            // 2. 資料收集
            let allRows = [];
            d1.forEach(r => { if(r.date && r.mp) allRows.push({m:r.m||'1', n:r.name, ds:parse(r.date, r.m||1, r.exclude), v:r.mp}); });
            d2.forEach(r => { if(r.date && r.inst) allRows.push({m:r.m||'1', n:r.name, ds:parse(r.date, r.m||1, r.exclude), v:r.inst}); });
            d3.forEach(r => { 
                if(r.date && r.mp) {
                    let mMatch = r.date.match(/^(\d+)/);
                    let m = mMatch ? mMatch[1] : '1';
                    allRows.push({m:m, n:r.name, ds:parse(r.date, m, r.exclude), v:r.mp}); 
                }
            });

            // 3. 按月份分組
            let grouped = {};
            for(let i=1; i<=12; i++) grouped[i] = [];
            allRows.forEach(r => { if(grouped[r.m]) grouped[r.m].push(r); });

            // 4. 渲染
            for(let m=1; m<=12; m++) {
                if(grouped[m].length === 0) continue;

                tbody.innerHTML += `<tr class="gantt-header-month"><td colspan="32">${m} 月份</td></tr>`;
                let monthlySum = Array(32).fill(0);

                grouped[m].forEach(r => {
                    // 上列：統一藍色色塊
                    let trVisual = `<tr>
                        <td rowspan="2" class="gantt-name-cell">${r.n}</td>`;
                    
                    // 下列：數據
                    let trData = `<tr>`;

                    for(let i=1; i<=31; i++) {
                        let active = r.ds.includes(i);
                        if(active) monthlySum[i] += parseInt(r.v);

                        // 統一使用 bar-active (藍色)
                        trVisual += `<td class="gantt-visual-row gantt-cell-bar ${active?'bar-active':''}"></td>`;
                        
                        trData += `<td class="gantt-data-row gantt-num" style="border-bottom:2px solid #cbd5e1;">
                            ${active ? `<input type="text" value="${r.v}" readonly>` : ''}
                        </td>`;
                    }
                    trVisual += '</tr>';
                    trData += '</tr>';
                    tbody.innerHTML += trVisual + trData;
                });

                let trStats = `<tr class="stats-row"><td>每日調用人數統計</td>`;
                for(let i=1; i<=31; i++) {
                    trStats += `<td>${monthlySum[i]>0 ? monthlySum[i] : ''}</td>`;
                }
                trStats += `</tr>`;
                tbody.innerHTML += trStats;
            }
        }

        // --- 通用操作 ---
        function addRow(t){if(t==1)d1.push({});if(t==2)d2.push({});if(t==3)d3.push({});renderAll();}
        function del(t,i){if(confirm('刪除此行?')){if(t==1)d1.splice(i,1);if(t==2)d2.splice(i,1);if(t==3)d3.splice(i,1);renderAll();}}
        function renderAll(){renderT1();renderT2();renderT3();}
        
        renderAll();

    </script>
</body>
</html>
